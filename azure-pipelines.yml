# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: 'windows-latest'

steps:
- task: runtsqltunittests@0
  displayName: 'run tSQLt Example unit tests' 
  inputs:
    connectionString: 'Data Source=sqlserver2019demo.uksouth.cloudapp.azure.com;Initial Catalog=tSQLt_Example;User ID=demoadmin;Password=SQLServerP@ssw0rd;'
    queryTimeout: '60'
    rootOutput: '$(System.DefaultWorkingDirectory)/tSQLt-out'
    testResultsFileName: 'TEST-Results.xml'
    enableCodeCoverage: true
    coberturaFileName: 'Cobertura.xml'
    htmlReportsOutput: 'AzurePipelines'
    runAllTests: false
    testOrClassName: 'AcceleratorTests'
  continueOnError: true

- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/TEST-*.xml'
    searchFolder: '$(Build.SourcesDirectory)/out'
    
- task: PublishCodeCoverageResults@1
  inputs:
    codeCoverageTool: 'Cobertura'
    summaryFileLocation: '$(Build.SourcesDirectory)/out/Cobertura.xml'
    reportDirectory: '$(Build.SourcesDirectory)/out/AzurePipelines'

  